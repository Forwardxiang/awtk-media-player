import os
import sys

FFMPEG_FLAGS=" -D_ISOC99_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -DPIC -DHAVE_AV_CONFIG_H "

env=DefaultEnvironment().Clone()
LIB_DIR=os.environ['LIB_DIR'];
env["CCFLAGS"] = env["CCFLAGS"] + FFMPEG_FLAGS 

AVFILTER_SOURCES=[
"ffmpeg/libavfilter/fifo.o",
"ffmpeg/libavfilter/framequeue.o",
"ffmpeg/libavfilter/formats.o",
"ffmpeg/libavfilter/graphparser.o",
"ffmpeg/libavfilter/audio.o",
"ffmpeg/libavfilter/af_aresample.o",
"ffmpeg/libavfilter/allfilters.o",
"ffmpeg/libavfilter/buffersrc.o",
"ffmpeg/libavfilter/transform.o",
"ffmpeg/libavfilter/video.o",
"ffmpeg/libavfilter/pthread.o",
"ffmpeg/libavfilter/drawutils.o",
"ffmpeg/libavfilter/framepool.o",
"ffmpeg/libavfilter/graphdump.o",
"ffmpeg/libavfilter/buffersink.o",
"ffmpeg/libavfilter/avfilter.o",
"ffmpeg/libavfilter/avfiltergraph.o",
]

AVUTIL_SOURCES=[
"ffmpeg/libavutil/reverse.o",
"ffmpeg/libavutil/time.o",
"ffmpeg/libavutil/hwcontext.o",
"ffmpeg/libavutil/error.o",
"ffmpeg/libavutil/utils.o",
"ffmpeg/libavutil/fifo.o",
"ffmpeg/libavutil/color_utils.o",
"ffmpeg/libavutil/blowfish.o",
"ffmpeg/libavutil/avsscanf.o",
"ffmpeg/libavutil/fixed_dsp.o",
"ffmpeg/libavutil/murmur3.o",
"ffmpeg/libavutil/stereo3d.o",
"ffmpeg/libavutil/slicethread.o",
"ffmpeg/libavutil/samplefmt.o",
"ffmpeg/libavutil/pixdesc.o",
"ffmpeg/libavutil/xga_font_data.o",
"ffmpeg/libavutil/sha.o",
"ffmpeg/libavutil/rational.o",
"ffmpeg/libavutil/base64.o",
"ffmpeg/libavutil/lfg.o",
"ffmpeg/libavutil/intmath.o",
"ffmpeg/libavutil/xtea.o",
"ffmpeg/libavutil/crc.o",
"ffmpeg/libavutil/float_dsp.o",
"ffmpeg/libavutil/file.o",
"ffmpeg/libavutil/md5.o",
"ffmpeg/libavutil/frame.o",
"ffmpeg/libavutil/cast5.o",
"ffmpeg/libavutil/spherical.o",
"ffmpeg/libavutil/audio_fifo.o",
"ffmpeg/libavutil/threadmessage.o",
"ffmpeg/libavutil/tree.o",
"ffmpeg/libavutil/adler32.o",
"ffmpeg/libavutil/timecode.o",
"ffmpeg/libavutil/sha512.o",
"ffmpeg/libavutil/tx.o",
"ffmpeg/libavutil/file_open.o",
"ffmpeg/libavutil/camellia.o",
"ffmpeg/libavutil/buffer.o",
"ffmpeg/libavutil/display.o",
"ffmpeg/libavutil/pixelutils.o",
"ffmpeg/libavutil/hmac.o",
"ffmpeg/libavutil/eval.o",
"ffmpeg/libavutil/dict.o",
"ffmpeg/libavutil/opt.o",
"ffmpeg/libavutil/random_seed.o",
"ffmpeg/libavutil/aes.o",
"ffmpeg/libavutil/mastering_display_metadata.o",
"ffmpeg/libavutil/log.o",
"ffmpeg/libavutil/cpu.o",
"ffmpeg/libavutil/tea.o",
"ffmpeg/libavutil/rc4.o",
"ffmpeg/libavutil/channel_layout.o",
"ffmpeg/libavutil/encryption_info.o",
"ffmpeg/libavutil/lzo.o",
"ffmpeg/libavutil/des.o",
"ffmpeg/libavutil/twofish.o",
"ffmpeg/libavutil/imgutils.o",
"ffmpeg/libavutil/lls.o",
"ffmpeg/libavutil/parseutils.o",
"ffmpeg/libavutil/mem.o",
"ffmpeg/libavutil/hdr_dynamic_metadata.o",
"ffmpeg/libavutil/log2_tab.o",
"ffmpeg/libavutil/ripemd.o",
"ffmpeg/libavutil/bprint.o",
"ffmpeg/libavutil/aes_ctr.o",
"ffmpeg/libavutil/integer.o",
"ffmpeg/libavutil/mathematics.o",
"ffmpeg/libavutil/downmix_info.o",
"ffmpeg/libavutil/hash.o",
"ffmpeg/libavutil/avstring.o",
]
env.Library(os.path.join(LIB_DIR, 'avutil'), AVUTIL_SOURCES)

AVDEVICE_SOURCES=[
"ffmpeg/libavdevice/utils.o",
"ffmpeg/libavdevice/avdevice.o",
"ffmpeg/libavdevice/alldevices.o",
]
env.Library(os.path.join(LIB_DIR, 'avdevice'), AVDEVICE_SOURCES)

AVFORMAT_SOURCES=[
"ffmpeg/libavformat/utils.o",
"ffmpeg/libavformat/dump.o",
"ffmpeg/libavformat/os_support.o",
"ffmpeg/libavformat/replaygain.o",
"ffmpeg/libavformat/protocols.o",
"ffmpeg/libavformat/isom.o",
"ffmpeg/libavformat/hevc.o",
"ffmpeg/libavformat/mux.o",
"ffmpeg/libavformat/movenchint.o",
"ffmpeg/libavformat/qtpalette.o",
"ffmpeg/libavformat/avc.o",
"ffmpeg/libavformat/rtp.o",
"ffmpeg/libavformat/movenccenc.o",
"ffmpeg/libavformat/oggparsevorbis.o",
"ffmpeg/libavformat/file.o",
"ffmpeg/libavformat/allformats.o",
"ffmpeg/libavformat/matroskadec.o",
"ffmpeg/libavformat/riff.o",
"ffmpeg/libavformat/metadata.o",
"ffmpeg/libavformat/options.o",
"ffmpeg/libavformat/mp3enc.o",
"ffmpeg/libavformat/vorbiscomment.o",
"ffmpeg/libavformat/url.o",
"ffmpeg/libavformat/m4vdec.o",
"ffmpeg/libavformat/id3v2.o",
"ffmpeg/libavformat/id3v2enc.o",
"ffmpeg/libavformat/rawdec.o",
"ffmpeg/libavformat/riffdec.o",
"ffmpeg/libavformat/mov_chan.o",
"ffmpeg/libavformat/aviobuf.o",
"ffmpeg/libavformat/riffenc.o",
"ffmpeg/libavformat/flac_picture.o",
"ffmpeg/libavformat/mov_esds.o",
"ffmpeg/libavformat/rawenc.o",
"ffmpeg/libavformat/matroska.o",
"ffmpeg/libavformat/rtpenc_chain.o",
"ffmpeg/libavformat/sdp.o",
"ffmpeg/libavformat/avio.o",
"ffmpeg/libavformat/movenc.o",
"ffmpeg/libavformat/format.o",
"ffmpeg/libavformat/rawutils.o",
"ffmpeg/libavformat/vpcc.o",
"ffmpeg/libavformat/h264dec.o",
"ffmpeg/libavformat/id3v1.o",
"ffmpeg/libavformat/mov.o",
"ffmpeg/libavformat/cutils.o",
"ffmpeg/libavformat/av1.o",
"ffmpeg/libavformat/rmsipr.o",
]
env.Library(os.path.join(LIB_DIR, 'avformat'), AVFORMAT_SOURCES)


AVSWSCALE_SOURCES=[
"ffmpeg/libswscale/utils.o",
"ffmpeg/libswscale/input.o",
"ffmpeg/libswscale/hscale_fast_bilinear.o",
"ffmpeg/libswscale/hscale.o",
"ffmpeg/libswscale/rgb2rgb.o",
"ffmpeg/libswscale/slice.o",
"ffmpeg/libswscale/output.o",
"ffmpeg/libswscale/options.o",
"ffmpeg/libswscale/vscale.o",
"ffmpeg/libswscale/swscale.o",
"ffmpeg/libswscale/gamma.o",
"ffmpeg/libswscale/swscale_unscaled.o",
"ffmpeg/libswscale/alphablend.o",
"ffmpeg/libswscale/yuv2rgb.o",
]
env.Library(os.path.join(LIB_DIR, 'avswscale'), AVSWSCALE_SOURCES)

AVCODEC_SOURCES=[
"ffmpeg/libavcodec/adts_parser.o",
"ffmpeg/libavcodec/opus_rc.o",
"ffmpeg/libavcodec/opus.o",
"ffmpeg/libavcodec/mjpegenc_huffman.o",
"ffmpeg/libavcodec/utils.o",
"ffmpeg/libavcodec/jrevdct.o",
"ffmpeg/libavcodec/h264_mb.o",
"ffmpeg/libavcodec/h264_parse.o",
"ffmpeg/libavcodec/null_bsf.o",
"ffmpeg/libavcodec/mpegaudiodata.o",
"ffmpeg/libavcodec/idctdsp.o",
"ffmpeg/libavcodec/h264_slice.o",
"ffmpeg/libavcodec/profiles.o",
"ffmpeg/libavcodec/h264chroma.o",
"ffmpeg/libavcodec/pixblockdsp.o",
"ffmpeg/libavcodec/mdct_fixed_32.o",
"ffmpeg/libavcodec/qsv_api.o",
"ffmpeg/libavcodec/h264_cabac.o",
"ffmpeg/libavcodec/faandct.o",
"ffmpeg/libavcodec/bitstream_filter.o",
"ffmpeg/libavcodec/jfdctfst.o",
"ffmpeg/libavcodec/fft_fixed_32.o",
"ffmpeg/libavcodec/opustab.o",
"ffmpeg/libavcodec/mpeg12framerate.o",
"ffmpeg/libavcodec/codec_desc.o",
"ffmpeg/libavcodec/vorbisdsp.o",
"ffmpeg/libavcodec/vorbis_data.o",
"ffmpeg/libavcodec/h264qpel.o",
"ffmpeg/libavcodec/fft_fixed.o",
"ffmpeg/libavcodec/parser.o",
"ffmpeg/libavcodec/aacdec.o",
"ffmpeg/libavcodec/mdct15.o",
"ffmpeg/libavcodec/ac3dec_data.o",
"ffmpeg/libavcodec/aacpsdsp_fixed.o",
"ffmpeg/libavcodec/h264_parser.o",
"ffmpeg/libavcodec/fft_float.o",
"ffmpeg/libavcodec/sinewin.o",
"ffmpeg/libavcodec/fft_init_table.o",
"ffmpeg/libavcodec/sinewin_fixed.o",
"ffmpeg/libavcodec/aacpsdsp_float.o",
"ffmpeg/libavcodec/mediacodec.o",
"ffmpeg/libavcodec/h264_ps.o",
"ffmpeg/libavcodec/h264dsp.o",
"ffmpeg/libavcodec/error_resilience.o",
"ffmpeg/libavcodec/simple_idct.o",
"ffmpeg/libavcodec/mpegaudiodecheader.o",
"ffmpeg/libavcodec/cabac.o",
"ffmpeg/libavcodec/adts_header.o",
"ffmpeg/libavcodec/xiph.o",
"ffmpeg/libavcodec/sbrdsp.o",
"ffmpeg/libavcodec/d3d11va.o",
"ffmpeg/libavcodec/opusdsp.o",
"ffmpeg/libavcodec/me_cmp.o",
"ffmpeg/libavcodec/options.o",
"ffmpeg/libavcodec/h264_cavlc.o",
"ffmpeg/libavcodec/faanidct.o",
"ffmpeg/libavcodec/aacdec_fixed.o",
"ffmpeg/libavcodec/avfft.o",
"ffmpeg/libavcodec/h264_picture.o",
"ffmpeg/libavcodec/aacps_fixed.o",
"ffmpeg/libavcodec/h264data.o",
"ffmpeg/libavcodec/latm_parser.o",
"ffmpeg/libavcodec/opus_silk.o",
"ffmpeg/libavcodec/bitstream.o",
"ffmpeg/libavcodec/jni.o",
"ffmpeg/libavcodec/h264idct.o",
"ffmpeg/libavcodec/aacps_float.o",
"ffmpeg/libavcodec/vorbis.o",
"ffmpeg/libavcodec/ac3dsp.o",
"ffmpeg/libavcodec/golomb.o",
"ffmpeg/libavcodec/aac_ac3_parser.o",
"ffmpeg/libavcodec/bitstream_filters.o",
"ffmpeg/libavcodec/opus_pvq.o",
"ffmpeg/libavcodec/allcodecs.o",
"ffmpeg/libavcodec/ac3dec_float.o",
"ffmpeg/libavcodec/avpacket.o",
"ffmpeg/libavcodec/bsf.o",
"ffmpeg/libavcodec/aacsbr_fixed.o",
"ffmpeg/libavcodec/fdctdsp.o",
"ffmpeg/libavcodec/raw.o",
"ffmpeg/libavcodec/opus_celt.o",
"ffmpeg/libavcodec/aactab.o",
"ffmpeg/libavcodec/pthread_slice.o",
"ffmpeg/libavcodec/dirac.o",
"ffmpeg/libavcodec/cbrt_data_fixed.o",
"ffmpeg/libavcodec/h264_sei.o",
"ffmpeg/libavcodec/pthread.o",
"ffmpeg/libavcodec/pthread_frame.o",
"ffmpeg/libavcodec/avdct.o",
"ffmpeg/libavcodec/ac3dec_fixed.o",
"ffmpeg/libavcodec/h264_loopfilter.o",
"ffmpeg/libavcodec/mdct_fixed.o",
"ffmpeg/libavcodec/ac3.o",
"ffmpeg/libavcodec/opusdec.o",
"ffmpeg/libavcodec/startcode.o",
"ffmpeg/libavcodec/parsers.o",
"ffmpeg/libavcodec/fmtconvert.o",
"ffmpeg/libavcodec/ac3_parser.o",
"ffmpeg/libavcodec/ac3tab.o",
"ffmpeg/libavcodec/mdct_float.o",
"ffmpeg/libavcodec/cbrt_data.o",
"ffmpeg/libavcodec/kbdwin.o",
"ffmpeg/libavcodec/aacsbr.o",
"ffmpeg/libavcodec/bswapdsp.o",
"ffmpeg/libavcodec/imgconvert.o",
"ffmpeg/libavcodec/h264_direct.o",
"ffmpeg/libavcodec/mpeg4audio.o",
"ffmpeg/libavcodec/vorbis_parser.o",
"ffmpeg/libavcodec/avpicture.o",
"ffmpeg/libavcodec/h264_refs.o",
"ffmpeg/libavcodec/h264dec.o",
"ffmpeg/libavcodec/h264pred.o",
"ffmpeg/libavcodec/encode.o",
"ffmpeg/libavcodec/sbrdsp_fixed.o",
"ffmpeg/libavcodec/h2645_parse.o",
"ffmpeg/libavcodec/videodsp.o",
"ffmpeg/libavcodec/vorbisdec.o",
"ffmpeg/libavcodec/decode.o",
"ffmpeg/libavcodec/dv_profile.o",
"ffmpeg/libavcodec/jfdctint.o",
"ffmpeg/libavcodec/mathtables.o",
]
env.Library(os.path.join(LIB_DIR, 'avcodec'), AVCODEC_SOURCES)

AVSWRESAMPLE_SOURCES =[
"ffmpeg/libswresample/resample.o",
"ffmpeg/libswresample/dither.o",
"ffmpeg/libswresample/swresample_frame.o",
"ffmpeg/libswresample/options.o",
"ffmpeg/libswresample/resample_dsp.o",
"ffmpeg/libswresample/rematrix.o",
"ffmpeg/libswresample/audioconvert.o",
"ffmpeg/libswresample/swresample.o",
]

env.Library(os.path.join(LIB_DIR, 'avswresample'), AVSWRESAMPLE_SOURCES)

X264_SOURCES =[
"x264/filters/video/internal.c",
"x264/filters/video/fix_vfr_pts.c",
"x264/filters/video/select_every.c",
"x264/filters/video/source.c",
"x264/filters/video/resize.c",
"x264/filters/video/crop.c",
"x264/filters/video/cache.c",
"x264/filters/video/video.c",
"x264/filters/video/depth.c",
"x264/filters/filters.c",
"x264/input/y4m.c",
"x264/input/input.c",
"x264/input/thread.c",
"x264/input/lavf.c",
"x264/input/timecode.c",
"x264/input/raw.c",
"x264/input/avs.c",
"x264/encoder/ratecontrol.c",
"x264/encoder/macroblock.c",
"x264/encoder/lookahead.c",
"x264/encoder/analyse.c",
"x264/encoder/set.c",
"x264/encoder/cabac.c",
"x264/encoder/slicetype-cl.c",
"x264/encoder/encoder.c",
"x264/encoder/me.c",
"x264/encoder/cavlc.c",
"x264/output/matroska_ebml.c",
"x264/output/raw.c",
"x264/output/matroska.c",
"x264/output/flv.c",
"x264/output/flv_bytestream.c",
"x264/common/bitstream.c",
"x264/common/osdep.c",
"x264/common/frame.c",
"x264/common/common.c",
"x264/common/deblock.c",
"x264/common/macroblock.c",
"x264/common/quant.c",
"x264/common/mvpred.c",
"x264/common/set.c",
"x264/common/cabac.c",
"x264/common/pixel.c",
"x264/common/rectangle.c",
"x264/common/tables.c",
"x264/common/cpu.c",
"x264/common/vlc.c",
"x264/common/mc.c",
"x264/common/dct.c",
"x264/common/predict.c",
"x264/common/base.c",
"x264/x264.c",
"x264/autocomplete.c",
"x264/encoder/api.c",
"x264/common/opencl.c",
"x264/common/threadpool.c",
]

env=DefaultEnvironment().Clone()
X264_FLAGS=" -DHIGH_BIT_DEPTH=0 -DBIT_DEPTH=8 "
env["CCFLAGS"] = env["CCFLAGS"] + X264_FLAGS 

env.Library(os.path.join(LIB_DIR, 'x264'), X264_SOURCES)

