import os
import sys

FFMPEG_FLAGS=" -D_ISOC99_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -DPIC -DHAVE_AV_CONFIG_H "

env=DefaultEnvironment().Clone()
LIB_DIR=os.environ['LIB_DIR'];
env["CCFLAGS"] = env["CCFLAGS"] + FFMPEG_FLAGS 

AVFILTER_SOURCES=[
"ffmpeg/libavfilter/fifo.c",
"ffmpeg/libavfilter/framequeue.c",
"ffmpeg/libavfilter/formats.c",
"ffmpeg/libavfilter/graphparser.c",
"ffmpeg/libavfilter/audio.c",
"ffmpeg/libavfilter/af_aresample.c",
"ffmpeg/libavfilter/allfilters.c",
"ffmpeg/libavfilter/buffersrc.c",
"ffmpeg/libavfilter/transform.c",
"ffmpeg/libavfilter/video.c",
"ffmpeg/libavfilter/pthread.c",
"ffmpeg/libavfilter/drawutils.c",
"ffmpeg/libavfilter/framepool.c",
"ffmpeg/libavfilter/graphdump.c",
"ffmpeg/libavfilter/buffersink.c",
"ffmpeg/libavfilter/avfilter.c",
"ffmpeg/libavfilter/avfiltergraph.c",
]
env.Library(os.path.join(LIB_DIR, 'avfilter'), AVFILTER_SOURCES)

AVUTIL_SOURCES=[
"ffmpeg/libavutil/reverse.c",
"ffmpeg/libavutil/time.c",
"ffmpeg/libavutil/hwcontext.c",
"ffmpeg/libavutil/error.c",
"ffmpeg/libavutil/utils.c",
"ffmpeg/libavutil/fifo.c",
"ffmpeg/libavutil/color_utils.c",
"ffmpeg/libavutil/blowfish.c",
"ffmpeg/libavutil/avsscanf.c",
"ffmpeg/libavutil/fixed_dsp.c",
"ffmpeg/libavutil/murmur3.c",
"ffmpeg/libavutil/stereo3d.c",
"ffmpeg/libavutil/slicethread.c",
"ffmpeg/libavutil/samplefmt.c",
"ffmpeg/libavutil/pixdesc.c",
"ffmpeg/libavutil/xga_font_data.c",
"ffmpeg/libavutil/sha.c",
"ffmpeg/libavutil/rational.c",
"ffmpeg/libavutil/base64.c",
"ffmpeg/libavutil/lfg.c",
"ffmpeg/libavutil/intmath.c",
"ffmpeg/libavutil/xtea.c",
"ffmpeg/libavutil/crc.c",
"ffmpeg/libavutil/float_dsp.c",
"ffmpeg/libavutil/file.c",
"ffmpeg/libavutil/md5.c",
"ffmpeg/libavutil/frame.c",
"ffmpeg/libavutil/cast5.c",
"ffmpeg/libavutil/spherical.c",
"ffmpeg/libavutil/audio_fifo.c",
"ffmpeg/libavutil/threadmessage.c",
"ffmpeg/libavutil/tree.c",
"ffmpeg/libavutil/adler32.c",
"ffmpeg/libavutil/timecode.c",
"ffmpeg/libavutil/sha512.c",
"ffmpeg/libavutil/tx.c",
"ffmpeg/libavutil/file_open.c",
"ffmpeg/libavutil/camellia.c",
"ffmpeg/libavutil/buffer.c",
"ffmpeg/libavutil/display.c",
"ffmpeg/libavutil/pixelutils.c",
"ffmpeg/libavutil/hmac.c",
"ffmpeg/libavutil/eval.c",
"ffmpeg/libavutil/dict.c",
"ffmpeg/libavutil/opt.c",
"ffmpeg/libavutil/random_seed.c",
"ffmpeg/libavutil/aes.c",
"ffmpeg/libavutil/mastering_display_metadata.c",
"ffmpeg/libavutil/log.c",
"ffmpeg/libavutil/cpu.c",
"ffmpeg/libavutil/tea.c",
"ffmpeg/libavutil/rc4.c",
"ffmpeg/libavutil/channel_layout.c",
"ffmpeg/libavutil/encryption_info.c",
"ffmpeg/libavutil/lzo.c",
"ffmpeg/libavutil/des.c",
"ffmpeg/libavutil/twofish.c",
"ffmpeg/libavutil/imgutils.c",
"ffmpeg/libavutil/lls.c",
"ffmpeg/libavutil/parseutils.c",
"ffmpeg/libavutil/mem.c",
"ffmpeg/libavutil/hdr_dynamic_metadata.c",
"ffmpeg/libavutil/log2_tab.c",
"ffmpeg/libavutil/ripemd.c",
"ffmpeg/libavutil/bprint.c",
"ffmpeg/libavutil/aes_ctr.c",
"ffmpeg/libavutil/integer.c",
"ffmpeg/libavutil/mathematics.c",
"ffmpeg/libavutil/downmix_info.c",
"ffmpeg/libavutil/hash.c",
"ffmpeg/libavutil/avstring.c",
]
env.Library(os.path.join(LIB_DIR, 'avutil'), AVUTIL_SOURCES)

AVDEVICE_SOURCES=[
"ffmpeg/libavdevice/utils.c",
"ffmpeg/libavdevice/avdevice.c",
"ffmpeg/libavdevice/alldevices.c",
]
env.Library(os.path.join(LIB_DIR, 'avdevice'), AVDEVICE_SOURCES)

AVFORMAT_SOURCES=[
"ffmpeg/libavformat/utils.c",
"ffmpeg/libavformat/dump.c",
"ffmpeg/libavformat/os_support.c",
"ffmpeg/libavformat/replaygain.c",
"ffmpeg/libavformat/protocols.c",
"ffmpeg/libavformat/isom.c",
"ffmpeg/libavformat/hevc.c",
"ffmpeg/libavformat/mux.c",
"ffmpeg/libavformat/movenchint.c",
"ffmpeg/libavformat/qtpalette.c",
"ffmpeg/libavformat/avc.c",
"ffmpeg/libavformat/rtp.c",
"ffmpeg/libavformat/movenccenc.c",
"ffmpeg/libavformat/oggparsevorbis.c",
"ffmpeg/libavformat/file.c",
"ffmpeg/libavformat/allformats.c",
"ffmpeg/libavformat/matroskadec.c",
"ffmpeg/libavformat/riff.c",
"ffmpeg/libavformat/metadata.c",
"ffmpeg/libavformat/options.c",
"ffmpeg/libavformat/mp3enc.c",
"ffmpeg/libavformat/vorbiscomment.c",
"ffmpeg/libavformat/url.c",
"ffmpeg/libavformat/m4vdec.c",
"ffmpeg/libavformat/id3v2.c",
"ffmpeg/libavformat/id3v2enc.c",
"ffmpeg/libavformat/rawdec.c",
"ffmpeg/libavformat/riffdec.c",
"ffmpeg/libavformat/mov_chan.c",
"ffmpeg/libavformat/aviobuf.c",
"ffmpeg/libavformat/riffenc.c",
"ffmpeg/libavformat/flac_picture.c",
"ffmpeg/libavformat/mov_esds.c",
"ffmpeg/libavformat/rawenc.c",
"ffmpeg/libavformat/matroska.c",
"ffmpeg/libavformat/rtpenc_chain.c",
"ffmpeg/libavformat/sdp.c",
"ffmpeg/libavformat/avio.c",
"ffmpeg/libavformat/movenc.c",
"ffmpeg/libavformat/format.c",
"ffmpeg/libavformat/rawutils.c",
"ffmpeg/libavformat/vpcc.c",
"ffmpeg/libavformat/h264dec.c",
"ffmpeg/libavformat/id3v1.c",
"ffmpeg/libavformat/mov.c",
"ffmpeg/libavformat/cutils.c",
"ffmpeg/libavformat/av1.c",
"ffmpeg/libavformat/rmsipr.c",
]
env.Library(os.path.join(LIB_DIR, 'avformat'), AVFORMAT_SOURCES)


AVSWSCALE_SOURCES=[
"ffmpeg/libswscale/utils.c",
"ffmpeg/libswscale/input.c",
"ffmpeg/libswscale/hscale_fast_bilinear.c",
"ffmpeg/libswscale/hscale.c",
"ffmpeg/libswscale/rgb2rgb.c",
"ffmpeg/libswscale/slice.c",
"ffmpeg/libswscale/output.c",
"ffmpeg/libswscale/options.c",
"ffmpeg/libswscale/vscale.c",
"ffmpeg/libswscale/swscale.c",
"ffmpeg/libswscale/gamma.c",
"ffmpeg/libswscale/swscale_unscaled.c",
"ffmpeg/libswscale/alphablend.c",
"ffmpeg/libswscale/yuv2rgb.c",
]
env.Library(os.path.join(LIB_DIR, 'avswscale'), AVSWSCALE_SOURCES)

AVCODEC_SOURCES=[
"ffmpeg/libavcodec/adts_parser.c",
"ffmpeg/libavcodec/opus_rc.c",
"ffmpeg/libavcodec/opus.c",
"ffmpeg/libavcodec/mjpegenc_huffman.c",
"ffmpeg/libavcodec/utils.c",
"ffmpeg/libavcodec/jrevdct.c",
"ffmpeg/libavcodec/h264_mb.c",
"ffmpeg/libavcodec/h264_parse.c",
"ffmpeg/libavcodec/null_bsf.c",
"ffmpeg/libavcodec/mpegaudiodata.c",
"ffmpeg/libavcodec/idctdsp.c",
"ffmpeg/libavcodec/h264_slice.c",
"ffmpeg/libavcodec/profiles.c",
"ffmpeg/libavcodec/h264chroma.c",
"ffmpeg/libavcodec/pixblockdsp.c",
"ffmpeg/libavcodec/mdct_fixed_32.c",
"ffmpeg/libavcodec/qsv_api.c",
"ffmpeg/libavcodec/h264_cabac.c",
"ffmpeg/libavcodec/faandct.c",
"ffmpeg/libavcodec/bitstream_filter.c",
"ffmpeg/libavcodec/jfdctfst.c",
"ffmpeg/libavcodec/fft_fixed_32.c",
"ffmpeg/libavcodec/opustab.c",
"ffmpeg/libavcodec/mpeg12framerate.c",
"ffmpeg/libavcodec/codec_desc.c",
"ffmpeg/libavcodec/vorbisdsp.c",
"ffmpeg/libavcodec/vorbis_data.c",
"ffmpeg/libavcodec/h264qpel.c",
"ffmpeg/libavcodec/fft_fixed.c",
"ffmpeg/libavcodec/parser.c",
"ffmpeg/libavcodec/aacdec.c",
"ffmpeg/libavcodec/mdct15.c",
"ffmpeg/libavcodec/ac3dec_data.c",
"ffmpeg/libavcodec/aacpsdsp_fixed.c",
"ffmpeg/libavcodec/h264_parser.c",
"ffmpeg/libavcodec/fft_float.c",
"ffmpeg/libavcodec/sinewin.c",
"ffmpeg/libavcodec/fft_init_table.c",
"ffmpeg/libavcodec/sinewin_fixed.c",
"ffmpeg/libavcodec/aacpsdsp_float.c",
"ffmpeg/libavcodec/mediacodec.c",
"ffmpeg/libavcodec/h264_ps.c",
"ffmpeg/libavcodec/h264dsp.c",
"ffmpeg/libavcodec/error_resilience.c",
"ffmpeg/libavcodec/simple_idct.c",
"ffmpeg/libavcodec/mpegaudiodecheader.c",
"ffmpeg/libavcodec/cabac.c",
"ffmpeg/libavcodec/adts_header.c",
"ffmpeg/libavcodec/xiph.c",
"ffmpeg/libavcodec/sbrdsp.c",
"ffmpeg/libavcodec/d3d11va.c",
"ffmpeg/libavcodec/opusdsp.c",
"ffmpeg/libavcodec/me_cmp.c",
"ffmpeg/libavcodec/options.c",
"ffmpeg/libavcodec/h264_cavlc.c",
"ffmpeg/libavcodec/faanidct.c",
"ffmpeg/libavcodec/aacdec_fixed.c",
"ffmpeg/libavcodec/avfft.c",
"ffmpeg/libavcodec/h264_picture.c",
"ffmpeg/libavcodec/aacps_fixed.c",
"ffmpeg/libavcodec/h264data.c",
"ffmpeg/libavcodec/latm_parser.c",
"ffmpeg/libavcodec/opus_silk.c",
"ffmpeg/libavcodec/bitstream.c",
"ffmpeg/libavcodec/jni.c",
"ffmpeg/libavcodec/h264idct.c",
"ffmpeg/libavcodec/aacps_float.c",
"ffmpeg/libavcodec/vorbis.c",
"ffmpeg/libavcodec/ac3dsp.c",
"ffmpeg/libavcodec/golomb.c",
"ffmpeg/libavcodec/aac_ac3_parser.c",
"ffmpeg/libavcodec/bitstream_filters.c",
"ffmpeg/libavcodec/opus_pvq.c",
"ffmpeg/libavcodec/allcodecs.c",
"ffmpeg/libavcodec/ac3dec_float.c",
"ffmpeg/libavcodec/avpacket.c",
"ffmpeg/libavcodec/bsf.c",
"ffmpeg/libavcodec/aacsbr_fixed.c",
"ffmpeg/libavcodec/fdctdsp.c",
"ffmpeg/libavcodec/raw.c",
"ffmpeg/libavcodec/opus_celt.c",
"ffmpeg/libavcodec/aactab.c",
"ffmpeg/libavcodec/pthread_slice.c",
"ffmpeg/libavcodec/dirac.c",
"ffmpeg/libavcodec/cbrt_data_fixed.c",
"ffmpeg/libavcodec/h264_sei.c",
"ffmpeg/libavcodec/pthread.c",
"ffmpeg/libavcodec/pthread_frame.c",
"ffmpeg/libavcodec/avdct.c",
"ffmpeg/libavcodec/ac3dec_fixed.c",
"ffmpeg/libavcodec/h264_loopfilter.c",
"ffmpeg/libavcodec/mdct_fixed.c",
"ffmpeg/libavcodec/ac3.c",
"ffmpeg/libavcodec/opusdec.c",
"ffmpeg/libavcodec/startcode.c",
"ffmpeg/libavcodec/parsers.c",
"ffmpeg/libavcodec/fmtconvert.c",
"ffmpeg/libavcodec/ac3_parser.c",
"ffmpeg/libavcodec/ac3tab.c",
"ffmpeg/libavcodec/mdct_float.c",
"ffmpeg/libavcodec/cbrt_data.c",
"ffmpeg/libavcodec/kbdwin.c",
"ffmpeg/libavcodec/aacsbr.c",
"ffmpeg/libavcodec/bswapdsp.c",
"ffmpeg/libavcodec/imgconvert.c",
"ffmpeg/libavcodec/h264_direct.c",
"ffmpeg/libavcodec/mpeg4audio.c",
"ffmpeg/libavcodec/vorbis_parser.c",
"ffmpeg/libavcodec/avpicture.c",
"ffmpeg/libavcodec/h264_refs.c",
"ffmpeg/libavcodec/h264dec.c",
"ffmpeg/libavcodec/h264pred.c",
"ffmpeg/libavcodec/encode.c",
"ffmpeg/libavcodec/sbrdsp_fixed.c",
"ffmpeg/libavcodec/h2645_parse.c",
"ffmpeg/libavcodec/videodsp.c",
"ffmpeg/libavcodec/vorbisdec.c",
"ffmpeg/libavcodec/decode.c",
"ffmpeg/libavcodec/dv_profile.c",
"ffmpeg/libavcodec/jfdctint.c",
"ffmpeg/libavcodec/mathtables.c",
]
env.Library(os.path.join(LIB_DIR, 'avcodec'), AVCODEC_SOURCES)

AVSWRESAMPLE_SOURCES =[
"ffmpeg/libswresample/resample.c",
"ffmpeg/libswresample/dither.c",
"ffmpeg/libswresample/swresample_frame.c",
"ffmpeg/libswresample/options.c",
"ffmpeg/libswresample/resample_dsp.c",
"ffmpeg/libswresample/rematrix.c",
"ffmpeg/libswresample/audioconvert.c",
"ffmpeg/libswresample/swresample.c",
]

env.Library(os.path.join(LIB_DIR, 'avswresample'), AVSWRESAMPLE_SOURCES)

X264_SOURCES =[
"x264/filters/video/internal.c",
"x264/filters/video/fix_vfr_pts.c",
"x264/filters/video/select_every.c",
"x264/filters/video/source.c",
"x264/filters/video/resize.c",
"x264/filters/video/crop.c",
"x264/filters/video/cache.c",
"x264/filters/video/video.c",
"x264/filters/video/depth.c",
"x264/filters/filters.c",
"x264/input/y4m.c",
"x264/input/input.c",
"x264/input/thread.c",
"x264/input/lavf.c",
"x264/input/timecode.c",
"x264/input/raw.c",
"x264/encoder/ratecontrol.c",
"x264/encoder/macroblock.c",
"x264/encoder/lookahead.c",
"x264/encoder/analyse.c",
"x264/encoder/set.c",
"x264/encoder/cabac.c",
"x264/encoder/slicetype-cl.c",
"x264/encoder/encoder.c",
"x264/encoder/me.c",
"x264/encoder/cavlc.c",
"x264/output/matroska_ebml.c",
"x264/output/raw.c",
"x264/output/matroska.c",
"x264/output/flv.c",
"x264/output/flv_bytestream.c",
"x264/common/bitstream.c",
"x264/common/osdep.c",
"x264/common/frame.c",
"x264/common/common.c",
"x264/common/deblock.c",
"x264/common/macroblock.c",
"x264/common/quant.c",
"x264/common/mvpred.c",
"x264/common/set.c",
"x264/common/cabac.c",
"x264/common/pixel.c",
"x264/common/rectangle.c",
"x264/common/tables.c",
"x264/common/cpu.c",
"x264/common/vlc.c",
"x264/common/mc.c",
"x264/common/dct.c",
"x264/common/predict.c",
"x264/common/base.c",
"x264/encoder/api.c",
"x264/common/threadpool.c",
]

env=DefaultEnvironment().Clone()
X264_FLAGS=" -DHIGH_BIT_DEPTH=0 -DBIT_DEPTH=8 "
env["CCFLAGS"] = env["CCFLAGS"] + X264_FLAGS 

env.Library(os.path.join(LIB_DIR, 'x264'), X264_SOURCES)

